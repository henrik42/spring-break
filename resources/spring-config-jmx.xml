<?xml version="1.0" encoding="ISO-8859-1"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
       xsi:schemaLocation="http://www.springframework.org/schema/beans 
			   http://www.springframework.org/schema/beans/spring-beans-3.0.xsd">

  <import resource="spring-config-factories.xml" />

  <bean id="exporter" class="org.springframework.jmx.export.MBeanExporter">

    <property name="namingStrategy" ref="namingStrategy" />

    <property name="assembler">
      <bean parent="clojure_fact">
	<constructor-arg value='
        (require (symbol "spring-break.jmx"))
	(spring-break.jmx/mbean-info-assembler 
	  #(not (nil? (re-matches #"clj_.*" %))))
        ' />
      </bean>
    </property>
  </bean>

  <bean id="namingStrategy" 
	class="org.springframework.jmx.export.naming.KeyNamingStrategy">
    <property name="mappings">
      <props>
	<prop key="clj_echo">bean:name=echo</prop>
	<prop key="clj_swap">bean:name=swap</prop>
      </props>
    </property>
  </bean>

  <bean id="clj_echo" parent="clojure_fact">
    <constructor-arg value="
    (require 'spring-break.jmx)
    (spring-break.jmx/fn-wrapper-of (fn [a] a))
    " />
  </bean>

  <bean id="clj_swap" parent="clojure_fact">
    <constructor-arg value="
    (require 'spring-break.jmx)
    (spring-break.jmx/fn-wrapper-of (fn [a b] [b a]))
    " />
  </bean>

</beans>