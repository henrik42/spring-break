<?xml version="1.0" encoding="ISO-8859-1"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
       xsi:schemaLocation="http://www.springframework.org/schema/beans 
			   http://www.springframework.org/schema/beans/spring-beans-3.0.xsd">

  <import resource="spring-config-factories.xml" />

  <bean id="exporter" class="org.springframework.jmx.export.MBeanExporter">

    <property name="namingStrategy">
      <bean parent="clojure_fact">
	<constructor-arg value='
        (proxy [org.springframework.jmx.export.naming.ObjectNamingStrategy][]
	  (getObjectName [bean-obj bean-key]
	    (javax.management.ObjectName. 
	      (format "clojure-beans:name=%s" bean-key))))
        ' />
      </bean>
    </property>

    <property name="assembler">
      <bean parent="clojure_fact">
	<constructor-arg value='
        (require (symbol "spring-break.jmx"))
	(spring-break.jmx/mbean-info-assembler 
	  #(boolean (re-matches #"clj_.*" %)))
        ' />
      </bean>
    </property>
  </bean>

  <bean id="clj_state" parent="clojure_fact">
    <constructor-arg value="
    (require 'spring-break.jmx)
    (spring-break.jmx/make-mbean (atom 42 :validator number?))
    #_ (spring-break.jmx/make-mbean (ref 42 :validator number?))
    " />
  </bean>

  <bean id="_clj_echo" parent="clojure_fact">
    <constructor-arg value="
    (require 'spring-break.jmx)
    (spring-break.jmx/fn-wrapper-of ^{:info :echo} (fn [a] a))
    " />
  </bean>

  <bean id="_clj_swap" parent="clojure_fact">
    <constructor-arg value="
    (require 'spring-break.jmx)
    (spring-break.jmx/fn-wrapper-of ^{:info :swap} (fn [a b] [b a]))
    " />
  </bean>

</beans>